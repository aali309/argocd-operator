apiVersion: argoproj.io/v1beta1
kind: ArgoCD
metadata:
  name: argocd
spec:
  sso:
    provider: dex
    dex:
      config: |
        connectors:
        - type: mock
          id: mock
          name: Mock
          config:
            users:
            - email: test@example.com
              name: Test User
              groups: ["test-group"]
  rbac:
    defaultPolicy: 'role:readonly'
    policyMatcherMode: 'glob'
    policy: |
      # This should fail - legacy encoded sub claims are no longer valid
      g, ChdleGFtcGxlQGFyZ29wcm9qLmlvEgJkZXhfY29ubl9pZA, role:test-role
      p, ChdleGFtcGxlQGFyZ29wcm9qLmlvEgJkZXhfY29ubl9pZA, applications, get, */*, allow

      # Only federated_claims.user_id should work
      g, test@example.com, role:test-role
      p, test@example.com, applications, get, */*, allow 
